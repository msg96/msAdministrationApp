###########################################################################################################################
###########################################################################################################################
###########################################################################################################################
###########################################################################################################################
############################################## -> DESGINED BY MATHEUS SANTOS ##############################################
###########################################################################################################################
###########################################################################################################################
###########################################################################################################################
###########################################################################################################################
################################# RELAX BECAUSE SECURITY INFOS NOT UPDATE FROM HERE :)    #################################
###########################################################################################################################
########    IMPORTS
###########################################################################################################################
from env import ENVVAR as ENV
from env import usersdb_conn
import psycopg2
###########################################################################################################################
########    VARIAVEIS
###########################################################################################################################
#
###########################################################################################################################
########    DATA BASE INFOS VIDE .GITIGNORE FIRST 
###########################################################################################################################
#
def tryconnect():
    try:
        connect = psycopg2.connect(usersdb_conn)
        return connect.cursor()
    except:
       return 0
###########################################################################################################################
########    EVENTO DE VERIFICAÇÃO DE LOGIN
###########################################################################################################################
def login (login, password) -> int:
    curCursor = tryconnect()
    if not curCursor:
        return 0
    useroremail =  ENV["emailrow"]  if "@" in login else ENV["userrow"]
        
    curCursor.execute(f"SELECT {ENV['dbprivileges']}, {ENV['dbusercolum']} from {ENV['pgusertable']} WHERE {useroremail}='{login}' AND {ENV['dbpasscolum']}='{password}'")
    matched = curCursor.fetchall()

######  IF YOU PUT SOME 0 OR "" IN LocalUser or LocalPass YOU DISABLE YOUR LOCAL TEST LOGIN. IT'S EASY :)
    if ENV["LocalUser"] and ENV["LocalPass"]:
        if login == ENV["LocalUser"] and password == ENV["LocalPass"]:
            return [1, "admin"]
#####   VERIFY IF SOME MATCH AND SEND SOME RESPONSE TO CALLER
    if not matched: 
        return 0
    else:
        return matched[0]